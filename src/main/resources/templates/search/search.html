<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>검색 결과</title>
  <link rel="stylesheet" href="/css/search/search.css"/>
  <link rel="icon" th:href="@{/favicon.ico}" />
</head>
<body>
<div class="main-container">

  <!-- 검색 폼 -->
  <form th:action="@{/search}" method="get">
    <input type="text" name="query" th:value="${query}" placeholder="검색어 입력" />
    <select name="type">
      <option value="ALL" th:selected="${type.name() == 'ALL'}">전체</option>
      <option value="ITEM" th:selected="${type.name() == 'ITEM'}">상품</option>
      <option value="USER" th:selected="${type.name() == 'USER'}">사용자</option>
    </select>
    <button type="submit">검색</button>
  </form>

  <!-- 상품 검색 결과 -->
  <div th:if="${result.items != null}">
    <h2>상품 결과</h2>

    <div class="item-grid">
      <div class="item-card" th:each="item : ${result.items.content}">
        <a th:href="@{/trade/{id}(id=${item.id})}">
          <!-- 이미지 처리 개선 -->
          <div class="item-image">
            <img th:src="${item.imageUrl != null and item.imageUrl != '' ? (item.imageUrl.startsWith('/') ? item.imageUrl : '/img/' + item.imageUrl) : 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjREJEQ0UyIi8+CjxwYXRoIGQ9Ik0xMDAgNzVMMTI1IDEwMEgxMTJWMTI1SDg4VjEwMEg3NUwxMDAgNzVaIiBmaWxsPSIjOTk5OTk5Ii8+Cjwvc3ZnPgo='}"
                 th:alt="${item.title}"
                 class="item-img"
                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjREJEQ0UyIi8+CjxwYXRoIGQ9Ik0xMDAgNzVMMTI1IDEwMEgxMTJWMTI1SDg4VjEwMEg3NUwxMDAgNzVaIiBmaWxsPSIjOTk5OTk5Ii8+PC9zdmc+Cg=='" />
          </div>

          <div class="item-info">
            <div class="item-title" th:utext="${item.title}">제목</div>
            <div class="item-price" th:text="${item.price + '원'}">가격</div>
            <div class="item-location" th:text="${item.location}">위치</div>
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- 사용자 검색 결과 -->
  <div th:if="${result.users != null}">
    <h2>사용자 결과</h2>
    <ul class="user-list">
      <li th:each="user : ${result.users.content}" class="user-item">
        <img th:if="${user.profileImageUrl != null and user.profileImageUrl != ''}"
             th:src="${user.profileImageUrl.startsWith('/') ? user.profileImageUrl : '/img/' + user.profileImageUrl}"
             alt="프로필"
             class="profile-img"
             onerror="this.src='/img/placeholder-profile.jpeg'" />
        <img th:if="${user.profileImageUrl == null or user.profileImageUrl == ''}"
             src="/img/placeholder-profile.jpeg"
             alt="프로필"
             class="profile-img" />
        <div class="user-info">
          <span class="user-nickname" th:text="${user.nickname}">닉네임</span>
          <span class="user-region" th:text="${user.region}">지역</span>
        </div>
      </li>
    </ul>
  </div>

  <!-- 페이지네이션 -->
  <div class="pagination" th:if="${result.items != null}">
    <a class="page-arrow" th:if="${!result.items.first}"
       th:href="@{/search(query=${query}, type=${type}, page=${result.items.number - 1}, size=${result.items.size})}">
      이전
    </a>
    <span class="page-info" th:text="${result.items.number + 1}">1</span>
    <span>/</span>
    <span class="page-info" th:text="${result.items.totalPages}">1</span>
    <a class="page-arrow" th:if="${!result.items.last}"
       th:href="@{/search(query=${query}, type=${type}, page=${result.items.number + 1}, size=${result.items.size})}">
      다음
    </a>
  </div>

</div>
<script src="/js/search.js"></script>
</body>
</html>