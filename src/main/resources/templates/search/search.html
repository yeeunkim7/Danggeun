<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>검색 결과</title>
  <link rel="stylesheet" href="/css/search/search.css"/>
  <link rel="icon" th:href="@{/favicon.ico}" />
</head>
<body>
<div class="main-container">

  <!-- 검색 폼 -->
  <form th:action="@{/search}" method="get">
    <input type="text" name="query" th:value="${query}" placeholder="검색어 입력" />
    <select name="type">
      <option value="ALL" th:selected="${type.name() == 'ALL'}">전체</option>
      <option value="ITEM" th:selected="${type.name() == 'ITEM'}">상품</option>
      <option value="USER" th:selected="${type.name() == 'USER'}">사용자</option>
    </select>
    <button type="submit">검색</button>
  </form>

  <!-- 상품 검색 결과 -->
  <div th:if="${result.items != null}">
    <h2>상품 결과</h2>

    <!-- 검색 결과를 리스트 형태로 표시 -->
    <div class="search-results">
      <div class="search-result-item" th:each="item : ${result.items.content}">
        <a th:href="@{/trade/{id}(id=${item.id})}" class="result-link">
          <div class="result-image-container">
            <img th:src="@{${item.imageUrl != null and !#strings.isEmpty(item.imageUrl) ?
                         (item.imageUrl.startsWith('/') ? item.imageUrl : '/img/' + item.imageUrl) :
                         '/img/mac.jpeg'}}"
                 th:alt="${item.title}"
                 class="result-image"
                 onerror="this.onerror=null; this.src='/img/mac.jpeg'" />
          </div>

          <div class="result-content">
            <h3 class="result-title" th:utext="${item.title}">제목</h3>
            <p class="result-summary" th:text="${item.content}">설명</p>
            <div class="result-meta">
              <span class="result-price" th:text="${#numbers.formatInteger(item.price, 1, 'COMMA')} + '원'">가격</span>
              <span class="result-location" th:text="${item.location}">위치</span>
              <span class="result-time" th:text="${#temporals.format(item.createdAt, 'MM-dd')}">날짜</span>
            </div>
          </div>
        </a>
      </div>
    </div>

    <!-- 검색 결과 없음 메시지 -->
    <div th:if="${#lists.isEmpty(result.items.content)}" class="no-results">
      <p>검색 결과가 없습니다.</p>
      <p>다른 검색어를 입력해보세요.</p>
    </div>
  </div>

  <!-- 사용자 검색 결과 -->
  <div th:if="${result.users != null}">
    <h2>사용자 결과</h2>
    <ul class="user-list">
      <li th:each="user : ${result.users.content}" class="user-item">
        <img th:src="@{${user.profileImageUrl != null and !#strings.isEmpty(user.profileImageUrl) ?
                     (user.profileImageUrl.startsWith('/') ? user.profileImageUrl : '/img/' + user.profileImageUrl) :
                     '/img/profile-placeholder.jpeg'}}"
             alt="프로필"
             class="profile-img"
             onerror="this.onerror=null; this.src='/img/profile-placeholder.jpeg'" />
        <div class="user-info">
          <span class="user-nickname" th:text="${user.nickname}">닉네임</span>
          <span class="user-region" th:text="${user.region}">지역</span>
        </div>
      </li>
    </ul>
  </div>

  <!-- 페이지네이션 -->
  <div class="pagination" th:if="${result.items != null and !#lists.isEmpty(result.items.content)}">
    <a class="page-arrow" th:if="${!result.items.first}"
       th:href="@{/search(query=${query}, type=${type}, page=${result.items.number - 1}, size=${result.items.size})}">
      이전
    </a>
    <span class="page-info" th:text="${result.items.number + 1}">1</span>
    <span>/</span>
    <span class="page-info" th:text="${result.items.totalPages}">1</span>
    <a class="page-arrow" th:if="${!result.items.last}"
       th:href="@{/search(query=${query}, type=${type}, page=${result.items.number + 1}, size=${result.items.size})}">
      다음
    </a>
  </div>

</div>
<script src="/js/search.js"></script>
</body>
</html>