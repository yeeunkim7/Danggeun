<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <title>동네 인증</title>

  <!-- CSRF 토큰 (있는 경우에만) -->
  <meta th:if="${_csrf}" name="_csrf" th:content="${_csrf.token}">
  <meta th:if="${_csrf}" name="_csrf_header" th:content="${_csrf.headerName}">

  <!-- CSS 파일 -->
  <link rel="stylesheet" href="/css/areaconfirm/areaConfirm.css">
</head>
<body>

<div class="container">
  <h3>어디에 살고 계신가요?</h3>

  <div id="errorMessage" class="error" style="display: none;"></div>
  <div id="successMessage" class="success" style="display: none;"></div>

  <div class="row">
    <input type="text" id="address" placeholder="예) 서울 강서구 화곡동" autocomplete="off" />
    <button type="button" id="searchBtn" onclick="searchAddress()">주소 검색</button>
  </div>

  <div class="muted">주소를 입력하거나, 아래 버튼으로 현재 위치를 불러오세요.</div>

  <div class="row">
    <button type="button" id="locationBtn" onclick="setLocation()">현재 위치로 설정</button>
  </div>

  <div id="map"></div>

  <p id="locationText" class="muted">지도에서 위치를 선택해주세요.</p>

  <button type="button" id="confirmBtn" onclick="confirmArea()" disabled>동네인증 완료하기</button>
</div>

<!-- 로그인 사용자 ID 전달 (JS 로드 전에 설정) -->
<script th:if="${user != null}">
  console.log('사용자 정보 설정:', [[${user.id}]], '[[${user.email}]]');
  window.currentUserId = [[${user.id}]];
</script>

<!-- 기존 동네 인증 정보가 있는 경우 -->
<script th:if="${existingArea != null}">
  console.log('기존 동네 인증 정보:', [[${existingArea}]]);
  window.existingArea = {
    address: '[[${existingArea.address}]]',
    latitude: [[${existingArea.latitude}]],
    longitude: [[${existingArea.longitude}]],
    confirmedAt: '[[${existingArea.confirmedAt}]]'
  };
</script>

<!-- JavaScript 파일 -->
<script src="/js/areaConfirm.js"></script>

<!-- Google Maps API 로드 (비동기) -->
<script th:if="${googleApiKey != null}"
        th:src="@{|https://maps.googleapis.com/maps/api/js?key=${googleApiKey}&libraries=places&callback=initMap|}"
        async defer
        onerror="console.error('Google Maps API 로드 실패'); showError('Google Maps를 로드할 수 없습니다.')"></script>

<!-- API 키가 없는 경우 경고 -->
<script th:if="${googleApiKey == null}">
  console.error('Google Maps API 키가 설정되지 않았습니다.');
  showError('Google Maps API 키가 설정되지 않았습니다. 관리자에게 문의하세요.');
</script>

</body>
</html>